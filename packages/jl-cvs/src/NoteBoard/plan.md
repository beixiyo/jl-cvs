# NoteBoard 功能开发路线图 (Feature Development Roadmap)

这是一个用于追踪 NoteBoard 未来功能开发的计划文档。我们将按照优先级和依赖关系，逐步实现这些功能，将 NoteBoard 从一个基础画板工具提升为更专业、功能更完善的应用。


### 1. 核心交互增强 (Core Interaction Enhancements)

**优先级：最高。** 这是后续许多功能的基础，能极大地提升应用的核心编辑能力。

- **选择工具 (Selection Tool)**
  - **功能**: 新增一个 `'select'` 模式。在此模式下，用户可以点击选中单个或多个图形（例如通过边框高亮显示），为后续的编辑操作提供目标。
  - **实现思路**: 需要一个 `selection` 管理器，维护当前被选中的形状列表。`mousedown` 事件需要判断是否点中了某个形状的包围盒。

- **形状的缩放与旋转 (Resizing & Rotating)**
  - **功能**: 当一个形状被选中后，其边框上会出现控制点（resize handles）。用户可以通过拖拽这些控制点来缩放形状。同时，可以提供一个旋转手柄来旋转形状。
  - **实现思路**: 需要在 `Renderer` 中为选中的图形绘制控制点。事件处理需要判断鼠标是否点在控制点上，并根据拖拽的位移来修改形状的坐标或旋转角度。这需要用到 Canvas 的变换（`ctx.translate`, `ctx.rotate`, `ctx.scale`）。

---

### 2. 功能与工具扩展 (Feature & Tool Expansion)

**优先级：中等。** 在完成核心交互后，这些功能将丰富应用的创作能力。

- **文本工具 (Text Tool)**
  - **功能**: 允许用户在画布的任意位置点击并输入文字。文字本身也应该是一个可拖拽、缩放、旋转和修改样式的形状。
  - **实现思路**: 实现一个 `TextShape`。当用户点击时，在对应位置动态创建一个 `<textarea>` 浮层让用户输入，输入完成后，将文本内容和位置记录到 `TextShape` 中，并触发重绘。

- **图层顺序调整 (Z-Indexing)**
  - **功能**: 为选中的形状提供“置于顶层”、“置于底层”、“上移一层”、“下移一层”的功能。
  - **实现思路**: `meta` 中已预留 `zIndex` 字段，渲染器也已支持。现在只需要提供一个修改形状 `zIndex` 并触发重绘的公共方法即可。

---

### 3. 应用级高级功能 (Application-level Advanced Features)

**优先级：长期。** 这些功能将让应用从一个“工具”变成一个完整的“产品”。

- **画布的保存与加载 (Serialization)**
  - **功能**: 将当前画布的所有内容（即 `history` 数组）序列化成一个 JSON 字符串，并可以将其保存为文件。用户之后可以上传这个文件来恢复整个画布状态。
  - **实现思路**: 提供 `toJSON()` 和 `loadFromJSON()` 方法。`toJSON` 只需 `JSON.stringify(noteBoard.history.curValue)`。`loadFromJSON` 则需要解析 JSON，并根据其中的数据重新创建 `Shape` 对象实例，然后设置到 `history` 中并重绘。

- **性能优化：笔刷路径简化**
  - **功能**: 对于非常长的笔刷路径，使用路径简化算法（如 Ramer-Douglas-Peucker 算法）来减少点的数量，同时基本保持其外观，以提升性能和减小历史记录体积。
  - **实现思路**: 在 `mouseup`，当一个 `Brush` 形状被创建并准备存入历史记录之前，对其 `points` 数组应用简化算法。

---

### 建议的实现路线图

为了保证功能迭代的平滑，建议按以下顺序进行开发：

1.  **实现选择工具** (为所有编辑操作提供基础)
2.  **实现形状的缩放与旋转** (最核心的编辑功能)
3.  **实现文本工具** (最常用的创作功能)
4.  **实现画布的保存与加载** (让用户的工作可以被保留)
5.  **实现图层顺序调整和性能优化** (体验改进)
